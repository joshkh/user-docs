
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>elastic-med &mdash; InterMine  documentation</title>
    
    <link rel="stylesheet" href="../../_static/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="InterMine  documentation" href="../../index.html" />
    <link rel="up" title="Apps/C Grunt Build" href="index.html" />
    <link rel="next" title="Apps/* Comparison" href="../apps-comparison.html" />
    <link rel="prev" title="publication-search" href="publication-search.html" /><!-- syntax highlighting -->
<link href="../../_static/pygments/radek.css" rel="stylesheet">
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../apps-comparison.html" title="Apps/* Comparison"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="publication-search.html" title="publication-search"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">InterMine  documentation</a> &raquo;</li>
          <li><a href="../index.html" >Embedding InterMine components</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Apps/C Grunt Build</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">elastic-med</a><ul>
<li><a class="reference internal" href="#initialize-project">Initialize Project</a><ul>
<li><a class="reference internal" href="#node-js-platform">Node.js platform</a></li>
<li><a class="reference internal" href="#bower-vendor-dependencies">Bower vendor dependencies</a></li>
<li><a class="reference internal" href="#grunt-building">Grunt building</a></li>
</ul>
</li>
<li><a class="reference internal" href="#elasticsearch">ElasticSearch</a><ul>
<li><a class="reference internal" href="#start-elasticsearch">Start ElasticSearch</a></li>
<li><a class="reference internal" href="#load-example-publications">Load example publications</a></li>
</ul>
</li>
<li><a class="reference internal" href="#source-files">Source files</a><ul>
<li><a class="reference internal" href="#example-page">Example page</a></li>
<li><a class="reference internal" href="#app-index">App index</a></li>
<li><a class="reference internal" href="#router">Router</a></li>
<li><a class="reference internal" href="#pages-templates">Pages templates</a></li>
<li><a class="reference internal" href="#application-search-template">Application search template</a></li>
<li><a class="reference internal" href="#application-search-component">Application search component</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="publication-search.html"
                        title="previous chapter">publication-search</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../apps-comparison.html"
                        title="next chapter">Apps/* Comparison</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/embedding/apps-c/elastic-med.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="elastic-med">
<h1>elastic-med<a class="headerlink" href="#elastic-med" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">&#64;in-progress</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can view the source files for this project in the <a class="reference external" href="https://github.com/intermine/intermine-apps-c/tree/master/elastic-med">intermine/intermine-apps-c</a> repo.</p>
</div>
<p>This document will guide you through the process of writing a JavaScript client side app (running completely in a browser) using <a class="reference external" href="http://bower.io/">Bower</a> and <a class="reference external" href="http://gruntjs.com/">Grunt</a> tools. The app will connect to an <a class="reference external" href="http://www.elasticsearch.org/">ElasticSearch</a> (ES) instance to do <em>search</em>. ES wraps Apache Lucene and serves as a repository of indexed documents that one can search agains. If you prefer a short gist head over to <a class="reference internal" href="usage.html"><em>Apps/C Usage</em></a> instead.</p>
<p>The app will have the following functionality:</p>
<ol class="arabic simple">
<li>Work with <em>cancer</em> related publications from PubMed.</li>
<li>Ask user for an input text and get back a list of publications.</li>
<li>Click on any of the results to see a detailed view.</li>
<li>From the document detail search for publications <em>like</em> this one.</li>
<li>Autocomple and provide suggestions for user&#8217;s input.</li>
</ol>
<p>Among the important libraries we will be using:</p>
<ol class="arabic simple">
<li><a class="reference external" href="http://bower.io/">Bower</a> to fetch vendor dependencies such as JavaScript, CSS or Fonts.</li>
<li><a class="reference external" href="http://canjs.com/">canJS</a> is a framework for client-side development handling routing, events etc.</li>
<li><a class="reference external" href="http://coffeescript.org/">CoffeeScript</a> a language that compiles down to JavaScript and makes writing an app easier.</li>
<li><a class="reference external" href="http://d3js.org/">D3</a> is used to manipulate documents based on data.</li>
<li><a class="reference external" href="http://www.elasticsearch.org/">ElasticSearch</a> a search server with a RESTful web service peddling JSON documents.</li>
<li><a class="reference external" href="http://foundation.zurb.com/">Foundation</a> is a CSS framework of reusable UI components.</li>
<li><a class="reference external" href="http://gruntjs.com/">Grunt</a> to build/transpile our source files.</li>
<li><a class="reference external" href="http://jquery.com/">jQuery</a> is a DOM manipulation library (and more).</li>
<li><a class="reference external" href="http://momentjs.com/">Moment</a> is a date library for parsing, manipulating and formatting dates.</li>
<li><a class="reference external" href="http://mustache.github.io/">Mustache</a> is a multi-platform templating language allowing us to embed dynamic objects in HTML.</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Nodejs">Node</a> JavaScript desktop software platform.</li>
<li><a class="reference external" href="http://learnboost.github.io/stylus/">Stylus</a> allows us to be more expressive and dynamic with CSS.</li>
<li><a class="reference external" href="http://underscorejs.org/">Underscore</a> is a utility toolbelt making actions such as iterating over items easier.</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Some of the code block examples on this page feature line numbers. Please view the page in a widescreen mode.</p>
</div>
<div class="section" id="initialize-project">
<h2>Initialize Project<a class="headerlink" href="#initialize-project" title="Permalink to this headline">¶</a></h2>
<p>The first step will be to setup our directory structure.</p>
<dl class="docutils">
<dt>build/</dt>
<dd>Will be the directory where our final app package will live. We will develop in languages like Stylus or CoffeeScript and need a way to package all these resources into one whole... directory. This is where all these files will live.</dd>
<dt>bower_components/</dt>
<dd>This directory will be automatically created and will contain libraries we have requested through the Bower system.</dd>
<dt>data/</dt>
<dd>Is a directory where we can keep data files that we will load to ES later.</dd>
<dt>example/</dt>
<dd>Contains an example of our app in use.</dd>
<dt>src/</dt>
<dd>Source files that our code will consist of.</dd>
<dt>bower.json</dt>
<dd>Will contain a listing of libraries we want to download using Bower.</dd>
<dt>package.json</dt>
<dd>Lists libraries we will need to compile and build our app.</dd>
</dl>
<div class="section" id="node-js-platform">
<h3>Node.js platform<a class="headerlink" href="#node-js-platform" title="Permalink to this headline">¶</a></h3>
<p>Since our application is targeting JavaScript in the browser, it is pretty useful if we use JavaScript on our computer (desktop) too. Enter <a class="reference external" href="http://en.wikipedia.org/wiki/Nodejs">Node</a> which allows us to execute JavaScript on our computers instead of just our browsers.</p>
<p>You can fetch <a class="reference external" href="http://nodejs.org/download/">binaries</a> from the homepage or use your (hopefully Linux) <a class="reference external" href="https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager">packman</a>.</p>
<p>Once Node is installed, edit the <tt class="docutils literal"><span class="pre">package.json</span></tt> file like so:</p>
<div class="highlight-json"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre> <span class="p">{</span>
     <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;elastic-med&quot;</span><span class="p">,</span>
     <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0&quot;</span><span class="p">,</span>
     <span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="nt">&quot;bower&quot;</span><span class="p">:</span> <span class="s2">&quot;~1.2.7&quot;</span><span class="p">,</span>
         <span class="nt">&quot;grunt&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.4.1&quot;</span><span class="p">,</span>

         <span class="nt">&quot;grunt-apps-c&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.10&quot;</span><span class="p">,</span>
         <span class="nt">&quot;grunt-contrib-concat&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.3.0&quot;</span><span class="p">,</span>
         <span class="nt">&quot;grunt-contrib-stylus&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.9.0&quot;</span><span class="p">,</span>
         <span class="nt">&quot;grunt-contrib-copy&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4.1&quot;</span><span class="p">,</span>

         <span class="nt">&quot;grunt-contrib-uglify&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.2.5&quot;</span><span class="p">,</span>
         <span class="nt">&quot;grunt-contrib-cssmin&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.6.2&quot;</span><span class="p">,</span>

         <span class="nt">&quot;elasticsearch&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.1&quot;</span><span class="p">,</span>
         <span class="nt">&quot;coffee-script&quot;</span><span class="p">:</span> <span class="s2">&quot;1.6.3&quot;</span><span class="p">,</span>
         <span class="nt">&quot;async&quot;</span><span class="p">:</span> <span class="s2">&quot;0.2.9&quot;</span><span class="p">,</span>
         <span class="nt">&quot;lodash&quot;</span><span class="p">:</span> <span class="s2">&quot;2.4.1&quot;</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This file tells Node which libraries will be used to build our app. These are not client-side libraries, but server-side if you will.</p>
<p>The top bit of the <tt class="docutils literal"><span class="pre">devDependencies</span></tt> lists a bunch of Grunt and Bower related libraries, the bottom one (<em>line 17 onward</em>) some libraries used to load ES with data.</p>
<p>In order to install all of these, execute the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>npm install -d
</pre></div>
</div>
</div>
<div class="section" id="bower-vendor-dependencies">
<h3>Bower vendor dependencies<a class="headerlink" href="#bower-vendor-dependencies" title="Permalink to this headline">¶</a></h3>
<p>Now we want to fetch libraries that our app, when running, will depend on.</p>
<p>Edit the <tt class="docutils literal"><span class="pre">bower.json</span></tt> file like so:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;elastic-med&quot;</span><span class="p">,</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;jquery&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0.3&quot;</span><span class="p">,</span>
        <span class="nt">&quot;lodash&quot;</span><span class="p">:</span> <span class="s2">&quot;2.4.1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;canjs&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0.4&quot;</span><span class="p">,</span>
        <span class="nt">&quot;elasticsearch&quot;</span><span class="p">:</span> <span class="s2">&quot;http://cdn.intermine.org/js/elasticsearch.js/1.0.2/elasticsearch.jquery.js&quot;</span><span class="p">,</span>
        <span class="nt">&quot;moment&quot;</span><span class="p">:</span> <span class="s2">&quot;2.4.0&quot;</span><span class="p">,</span>
        <span class="nt">&quot;d3&quot;</span><span class="p">:</span> <span class="s2">&quot;3.3.13&quot;</span><span class="p">,</span>
        <span class="nt">&quot;colorbrewer&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
        <span class="nt">&quot;hint.css&quot;</span><span class="p">:</span> <span class="s2">&quot;1.3.1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;foundation&quot;</span><span class="p">:</span> <span class="s2">&quot;5.0.2&quot;</span><span class="p">,</span>
        <span class="nt">&quot;font-awesome&quot;</span><span class="p">:</span> <span class="s2">&quot;4.0.3&quot;</span><span class="p">,</span>
        <span class="nt">&quot;simple-lru&quot;</span><span class="p">:</span> <span class="s2">&quot;~0.0.2&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The file has a bunch of key-value pairs.</p>
<dl class="docutils">
<dt>name</dt>
<dd>Name of our application in the Bower ecosystem, required.</dd>
<dt>version</dt>
<dd>Version number in the Bower ecosystem, required.</dd>
<dt>dependencies</dt>
<dd>Lists the actual libraries and their versions to fetch. You can populate this list by executing <tt class="docutils literal"><span class="pre">$</span> <span class="pre">bower</span> <span class="pre">install</span> <span class="pre">jquery</span> <span class="pre">--save</span></tt> for example. That will download the latest version of the <tt class="docutils literal"><span class="pre">jquery</span></tt> component into the <tt class="docutils literal"><span class="pre">bower_components/</span></tt> directory. You can <a class="reference external" href="http://sindresorhus.com/bower-components/">search</a> for available components using <tt class="docutils literal"><span class="pre">$</span> <span class="pre">bower</span> <span class="pre">search</span> <span class="pre">jquery</span></tt>. To actually trigger a search, execute <tt class="docutils literal"><span class="pre">$</span> <span class="pre">bower</span> <span class="pre">install</span></tt>. The different libraries will be introduced as we code along.</dd>
</dl>
</div>
<div class="section" id="grunt-building">
<h3>Grunt building<a class="headerlink" href="#grunt-building" title="Permalink to this headline">¶</a></h3>
<p>Grunt is used to munge files together and execute commands on them. Create a file called <tt class="docutils literal"><span class="pre">Gruntfile.coffee</span></tt>:</p>
<div class="highlight-coffee-script"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</pre></div></td><td class="code"><div class="highlight"><pre> <span class="nv">module.exports = </span><span class="nf">(grunt) -&gt;</span>
     <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span>
         <span class="nv">pkg: </span><span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="s">&quot;package.json&quot;</span><span class="p">)</span>

         <span class="nv">apps_c:</span>
             <span class="nv">commonjs:</span>
                 <span class="nv">src: </span><span class="p">[</span> <span class="s">&#39;src/**/*.{coffee,mustache}&#39;</span> <span class="p">]</span>
                 <span class="nv">dest: </span><span class="s">&#39;build/js/em.js&#39;</span>
                 <span class="nv">options:</span>
                     <span class="nv">main: </span><span class="s">&#39;src/app.coffee&#39;</span>
                     <span class="nv">name: </span><span class="s">&#39;em&#39;</span>

         <span class="nv">stylus:</span>
             <span class="nv">compile:</span>
                 <span class="nv">src: </span><span class="p">[</span> <span class="s">&#39;src/styles/app.styl&#39;</span> <span class="p">]</span>
                 <span class="nv">dest: </span><span class="s">&#39;build/css/em.css&#39;</span>

         <span class="nv">concat:</span>
             <span class="nv">scripts:</span>
                 <span class="nv">src: </span><span class="p">[</span>
                     <span class="c1"># Vendor dependencies.</span>
                     <span class="s">&#39;bower_components/jquery/jquery.js&#39;</span>
                     <span class="s">&#39;bower_components/lodash/dist/lodash.js&#39;</span>
                     <span class="s">&#39;bower_components/canjs/can.jquery-2.js&#39;</span>
                     <span class="s">&#39;bower_components/canjs/can.map.setter.js&#39;</span>
                     <span class="s">&#39;bower_components/elasticsearch/index.js&#39;</span>
                     <span class="s">&#39;bower_components/moment/moment.js&#39;</span>
                     <span class="s">&#39;bower_components/colorbrewer/colorbrewer.js&#39;</span>
                     <span class="s">&#39;bower_components/d3/d3.js&#39;</span>
                     <span class="s">&#39;bower_components/simple-lru/index.js&#39;</span>
                     <span class="c1"># Our app.</span>
                     <span class="s">&#39;build/js/em.js&#39;</span>
                 <span class="p">]</span>
                 <span class="nv">dest: </span><span class="s">&#39;build/js/em.bundle.js&#39;</span>
                 <span class="nv">options:</span>
                     <span class="nv">separator: </span><span class="s">&#39;;&#39;</span> <span class="c1"># for minification purposes</span>

             <span class="nv">styles:</span>
                 <span class="nv">src: </span><span class="p">[</span>
                     <span class="s">&#39;bower_components/foundation/css/normalize.css&#39;</span>
                     <span class="s">&#39;bower_components/foundation/css/foundation.css&#39;</span>
                     <span class="s">&#39;bower_components/hint.css/hint.css&#39;</span>
                     <span class="s">&#39;bower_components/font-awesome/css/font-awesome.css&#39;</span>
                     <span class="s">&#39;src/styles/fonts.css&#39;</span>
                     <span class="s">&#39;build/css/em.css&#39;</span>
                 <span class="p">]</span>
                 <span class="nv">dest: </span><span class="s">&#39;build/css/em.bundle.css&#39;</span>

         <span class="nv">copy:</span>
             <span class="nv">fonts:</span>
                 <span class="nv">src: </span><span class="p">[</span> <span class="s">&#39;bower_components/font-awesome/fonts/*&#39;</span> <span class="p">]</span>
                 <span class="nv">dest: </span><span class="s">&#39;build/fonts/&#39;</span>
                 <span class="nv">expand: </span><span class="kc">yes</span>
                 <span class="nv">flatten: </span><span class="kc">yes</span>

         <span class="nv">uglify:</span>
             <span class="nv">scripts:</span>
                 <span class="nv">files:</span>
                     <span class="s">&#39;build/js/em.min.js&#39;</span><span class="o">:</span> <span class="s">&#39;build/js/em.js&#39;</span>
                     <span class="s">&#39;build/js/em.bundle.min.js&#39;</span><span class="o">:</span> <span class="s">&#39;build/js/em.bundle.js&#39;</span>

         <span class="nv">cssmin:</span>
             <span class="nv">combine:</span>
                 <span class="nv">files:</span>
                     <span class="s">&#39;build/css/em.bundle.min.css&#39;</span><span class="o">:</span> <span class="s">&#39;build/css/em.bundle.css&#39;</span>
                     <span class="s">&#39;build/css/em.min.css&#39;</span><span class="o">:</span> <span class="s">&#39;build/css/em.css&#39;</span>

     <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s">&#39;grunt-apps-c&#39;</span><span class="p">)</span>
     <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s">&#39;grunt-contrib-stylus&#39;</span><span class="p">)</span>
     <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s">&#39;grunt-contrib-concat&#39;</span><span class="p">)</span>
     <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s">&#39;grunt-contrib-copy&#39;</span><span class="p">)</span>
     <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s">&#39;grunt-contrib-uglify&#39;</span><span class="p">)</span>
     <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s">&#39;grunt-contrib-cssmin&#39;</span><span class="p">)</span>

     <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span>
         <span class="s">&#39;apps_c&#39;</span>
         <span class="s">&#39;stylus&#39;</span>
         <span class="s">&#39;concat&#39;</span>
         <span class="s">&#39;copy&#39;</span>
     <span class="p">])</span>

     <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s">&#39;minify&#39;</span><span class="p">,</span> <span class="p">[</span>
         <span class="s">&#39;uglify&#39;</span>
         <span class="s">&#39;cssmin&#39;</span>
     <span class="p">])</span>
</pre></div>
</td></tr></table></div>
<p>This file is written in <a class="reference external" href="http://coffeescript.org/">CoffeeScript</a> and lists the tasks to run when we want to build our app. From the top:</p>
<dl class="docutils">
<dt>apps_c</dt>
<dd>This directive says that we want to take any <a class="reference external" href="http://coffeescript.org/">CoffeeScript</a> and <a class="reference external" href="http://mustache.github.io/">Mustache</a> files we find in <tt class="docutils literal"><span class="pre">src/</span></tt> and make them into one JavaScript package.</dd>
<dt>stylus</dt>
<dd>Take a <a class="reference external" href="http://learnboost.github.io/stylus/">Stylus</a> file and turn it into CSS.</dd>
<dt>concat</dt>
<dd>Take our vendor files (installed using <a class="reference external" href="http://bower.io/">Bower</a>) and, together with our app, make them into a bundle. If someone else wants to use our app they need our app and its deps too, so this one file will do it for them. Do the same to CSS too.</dd>
<dt>copy</dt>
<dd>A task that copies fonts from <a class="reference external" href="http://fontawesome.io/">FontAwesome</a> into our build directory.</dd>
<dt>uglify</dt>
<dd>Minify our built JavaScript files. This makes them small, but unreadable so not great for debugging.</dd>
<dt>cssmin</dt>
<dd>The same as <tt class="docutils literal"><span class="pre">uglify</span></tt> but for CSS</dd>
</dl>
<p><em>Lines 76 and 83</em> have two calls to <tt class="docutils literal"><span class="pre">grunt.registerTask</span></tt> which bundle a bunch of tasks together. For example running <tt class="docutils literal"><span class="pre">$</span> <span class="pre">grunt</span> <span class="pre">minify</span></tt> will run the <tt class="docutils literal"><span class="pre">uglify</span></tt> and <tt class="docutils literal"><span class="pre">cssmin</span></tt> tasks.</p>
<p>While developing it is quite useful to watch the source files and re-run the build task:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>watch --color grunt
</pre></div>
</div>
<p>This will run the default Grunt task every 2s.</p>
</div>
</div>
<div class="section" id="elasticsearch">
<h2>ElasticSearch<a class="headerlink" href="#elasticsearch" title="Permalink to this headline">¶</a></h2>
<div class="section" id="start-elasticsearch">
<h3>Start ElasticSearch<a class="headerlink" href="#start-elasticsearch" title="Permalink to this headline">¶</a></h3>
<p>ES will hold our index of publications. <a class="reference external" href="http://www.elasticsearch.org/download/">Fetch</a> it and then unpack it somewhere.</p>
<p>To start it:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>./bin/elasticsearch
</pre></div>
</div>
<p>Check that it is up by visiting port <tt class="docutils literal"><span class="pre">9200</span></tt>. If you see a JSON message, it is up.</p>
</div>
<div class="section" id="load-example-publications">
<h3>Load example publications<a class="headerlink" href="#load-example-publications" title="Permalink to this headline">¶</a></h3>
<p>To index some documents, use whichever <a class="reference external" href="http://www.elasticsearch.org/guide/">client</a>. I was using the JavaScript one and if you check the <tt class="docutils literal"><span class="pre">data/</span></tt> dir in <tt class="docutils literal"><span class="pre">elastic-med</span></tt> on <a class="reference external" href="https://github.com/">GitHub</a> you will be able to see one way that documents can be indexed. In that example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>./node_modules/.bin/coffee ./data/index.coffee
</pre></div>
</div>
<p>That will index (after a few seconds) 1000 cancer publications found in <tt class="docutils literal"><span class="pre">cancer.json</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">convert.coffee</span></tt> file was used to convert source XML to JSON.</p>
<p>Check that documents got indexed by visiting the document URL in the browser:</p>
<p>You should get back a JSON document back provided you are using index <tt class="docutils literal"><span class="pre">publications</span></tt>, type <tt class="docutils literal"><span class="pre">publication</span></tt> and you have a document under the id <tt class="docutils literal"><span class="pre">438</span></tt>.</p>
</div>
</div>
<div class="section" id="source-files">
<h2>Source files<a class="headerlink" href="#source-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="example-page">
<h3>Example page<a class="headerlink" href="#example-page" title="Permalink to this headline">¶</a></h3>
<p>One needs an access point where our app will get loaded with particular configuration. This is where the <tt class="docutils literal"><span class="pre">example/index.html</span></tt> comes in:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre> <span class="cp">&lt;!doctype html&gt;</span>
 <span class="nt">&lt;html&gt;</span>
 <span class="nt">&lt;head&gt;</span>
     <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;title&gt;</span>ElasticMed<span class="nt">&lt;/title&gt;</span>

     <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;build/css/em.bundle.css&quot;</span> <span class="na">media=</span><span class="s">&quot;all&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;build/js/em.bundle.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
 <span class="nt">&lt;/head&gt;</span>
 <span class="nt">&lt;body&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;app&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
     <span class="nt">&lt;script&gt;</span>
         <span class="c1">// Once scripts have loaded.</span>
         <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
             <span class="c1">// ...show the app.</span>
             <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;em&#39;</span><span class="p">)({</span>
                 <span class="s1">&#39;el&#39;</span><span class="o">:</span> <span class="s1">&#39;#app&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;service&#39;</span><span class="o">:</span> <span class="s1">&#39;http://newvegas:9200&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;index&#39;</span><span class="o">:</span>   <span class="s1">&#39;publications&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;type&#39;</span><span class="o">:</span>    <span class="s1">&#39;publication&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;query&#39;</span><span class="o">:</span>   <span class="s1">&#39;breast size exercise cancer&#39;</span>
             <span class="p">});</span>
         <span class="p">});</span>
     <span class="nt">&lt;/script&gt;</span>
 <span class="nt">&lt;/body&gt;</span>
 <span class="nt">&lt;/html&gt;</span>
</pre></div>
</td></tr></table></div>
<p>This file does not do anything else other then load our built CSS and JS files (<em>lines 7 and 9</em>) and starts our app. In our example we are pointing to a <tt class="docutils literal"><span class="pre">build</span></tt> directory relative to the <tt class="docutils literal"><span class="pre">example</span></tt> directory. So let&#8217;s make a symbolic link to the actual <tt class="docutils literal"><span class="pre">build</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>ln -s ../build build/
</pre></div>
</div>
<p>Such links get preserved when version controlling using <a class="reference external" href="http://git-scm.com/">Git</a>. We are linking to our bundled builds that contain vendor dependencies too.</p>
<p>Then we are waiting for the page to load and call our (future) app with some config.</p>
<p>The name <tt class="docutils literal"><span class="pre">em</span></tt> is being configured in the <tt class="docutils literal"><span class="pre">Gruntfile.coffee</span></tt> file in the <tt class="docutils literal"><span class="pre">apps-c</span></tt> task.</p>
<p>As for the config:</p>
<dl class="docutils">
<dt>el</dt>
<dd>Selector where our app should be displayed.</dd>
<dt>service</dt>
<dd>Points to the <a class="reference external" href="http://www.elasticsearch.org/">ES</a> endpoint. By default it starts on port <tt class="docutils literal"><span class="pre">9200</span></tt>.</dd>
<dt>index</dt>
<dd>Refers to the <a class="reference external" href="http://www.elasticsearch.org/">ES</a> index we are using.</dd>
<dt>type</dt>
<dd>Refers to the type of <a class="reference external" href="http://www.elasticsearch.org/">ES</a> documents we are storing in our index.</dd>
<dt>query</dt>
<dd>Is a default query we will want to show when our app loads.</dd>
</dl>
<p>The <tt class="docutils literal"><span class="pre">require</span></tt> call on <em>line 17</em> relates to <a class="reference external" href="http://addyosmani.com/writing-modular-js/">CommonJS</a>. It is one way of loading JavaScript modules. It avoids having to expose all of our functions and objects on the global (<tt class="docutils literal"><span class="pre">window</span></tt>) object and implements a way of relating between different files.</p>
</div>
<div class="section" id="app-index">
<h3>App index<a class="headerlink" href="#app-index" title="Permalink to this headline">¶</a></h3>
<p>We have asked to load an app in our <tt class="docutils literal"><span class="pre">example/index.html</span></tt> page, now we are going to write the backing code.</p>
<p>The <tt class="docutils literal"><span class="pre">apps-c</span></tt> task (in <tt class="docutils literal"><span class="pre">Gruntfile.coffee</span></tt>) contains the following two options:</p>
<dl class="docutils">
<dt>name</dt>
<dd>How do we call our app for <a class="reference external" href="http://addyosmani.com/writing-modular-js/">CommonJS</a> <tt class="docutils literal"><span class="pre">require</span></tt> call.</dd>
<dt>main</dt>
<dd>Contains a path (an index) that will be called when we actually call the <tt class="docutils literal"><span class="pre">require</span></tt> function.</dd>
</dl>
<p>We have specified that our app index lives in <tt class="docutils literal"><span class="pre">src/app.coffee</span></tt> so let&#8217;s create this file:</p>
<div class="highlight-coffee-script"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre> <span class="nv">module.exports = </span><span class="nf">(opts) -&gt;</span>
     <span class="c1"># Explode ejs options.</span>
     <span class="p">{</span> <span class="nx">service</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">type</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">opts</span>

     <span class="c1"># Init the ejs client.</span>
     <span class="nx">ejs</span><span class="p">.</span><span class="nx">attr</span> <span class="p">{</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="s">&#39;client&#39;</span><span class="o">:</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">es</span><span class="p">.</span><span class="nx">Client</span><span class="p">({</span> <span class="s">&#39;hosts&#39;</span><span class="o">:</span> <span class="nx">service</span> <span class="p">})</span> <span class="p">}</span>

     <span class="c1"># Start routing.</span>
     <span class="k">new</span> <span class="nx">Routing</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">el</span>
     <span class="nx">do</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">ready</span>

     <span class="c1"># Have we launched on the index?</span>
     <span class="k">if</span> <span class="nx">can</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">current</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
         <span class="c1"># Manually change the query to init the search.</span>
         <span class="nx">query</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&#39;current&#39;</span><span class="p">,</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">query</span> <span class="o">or</span> <span class="s">&#39;&#39;</span> <span class="c1"># &#39;&#39; is the default...</span>
</pre></div>
</td></tr></table></div>
<p>Each module (file) in our app needs to export some functionality. When we call <tt class="docutils literal"><span class="pre">require</span></tt> we will be getting this functionality.</p>
<p>We are going to be using <a class="reference external" href="http://canjs.com/">canJS</a> which consists of objects that can be <em>observed</em>. What this means is that when their values change, others listening to this changes will be notified. When we want to <a class="reference external" href="http://canjs.com/docs/can.Map.prototype.attr.html">change</a> their value we call <tt class="docutils literal"><span class="pre">attr</span></tt> function on them. One such example is on <em>line 7</em> where we change the value of <tt class="docutils literal"><span class="pre">index</span></tt>, <tt class="docutils literal"><span class="pre">type</span></tt> and <tt class="docutils literal"><span class="pre">client</span></tt> as passed in by the user from <tt class="docutils literal"><span class="pre">example/index.html</span></tt>.</p>
<dl class="docutils">
<dt>$.es.Client</dt>
<dd>Refers to <a class="reference external" href="http://www.elasticsearch.org/">ElasticSearch</a> client in JavaScript which we have installed using <a class="reference external" href="http://bower.io/">Bower</a> and munged in a bundle using <a class="reference external" href="http://gruntjs.com/">Grunt</a> as specified in <tt class="docutils literal"><span class="pre">Gruntfile.coffee</span></tt>.</dd>
<dt>Routing()</dt>
<dd>Is a call to a future <a class="reference external" href="http://canjs.com/guides/Controls.html">canControl</a> component which will setup our routing. We need a way of change between an index page that does search and a detail page that shows a detail...</dd>
<dt>can.route.ready</dt>
<dd>Actually tells <a class="reference external" href="http://canjs.com/">canJS</a> to start listening to changes in the browser address.</dd>
</dl>
<p>On <em>line 14</em> we see an example of checking whether we are looking at the index page when the app loads. If so we are changing a <tt class="docutils literal"><span class="pre">current</span></tt> attribute on a (futute) <a class="reference external" href="http://canjs.com/docs/can.Map.html">canMap</a> component which will correspond to the query, meaning user query input. Our <tt class="docutils literal"><span class="pre">example/index.html</span></tt> page contains an example query to use in this case.</p>
</div>
<div class="section" id="router">
<h3>Router<a class="headerlink" href="#router" title="Permalink to this headline">¶</a></h3>
<p>Now we need to write the actual router component. It will be a type of <a class="reference external" href="http://canjs.com/guides/Controls.html">canControl</a> and lives in the <tt class="docutils literal"><span class="pre">src/app.coffee</span></tt> file too. Since we do not want/need to export this functionality, it will be placed above the current <tt class="docutils literal"><span class="pre">module.exports</span></tt> call:</p>
<div class="highlight-coffee-script"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre> <span class="c1"># Router switching between pages.</span>
 <span class="nv">Routing = </span><span class="nx">can</span><span class="p">.</span><span class="nx">Control</span>

     <span class="nv">init: </span><span class="nf">-&gt;</span>
         <span class="c1"># Load the components.</span>
         <span class="p">(</span> <span class="nx">require</span> <span class="s">&quot;./components/</span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">components</span> <span class="p">)</span>

         <span class="c1"># Setup the UI.</span>
         <span class="nv">layout = </span><span class="nx">require</span> <span class="s">&#39;./templates/layout&#39;</span>
         <span class="nx">@element</span><span class="p">.</span><span class="nx">html</span> <span class="nx">render</span> <span class="nx">layout</span><span class="p">,</span> <span class="nx">helpers</span>

     <span class="c1"># Index.</span>
     <span class="nv">route: </span><span class="nf">-&gt;</span>
         <span class="nv">template = </span><span class="nx">require</span> <span class="s">&#39;./templates/page/index&#39;</span>
         <span class="nx">@render</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="p">{},</span> <span class="s">&#39;ElasticMed&#39;</span><span class="p">)</span>

     <span class="c1"># Document detail.</span>
     <span class="s">&#39;doc/:oid route&#39;</span><span class="o">:</span> <span class="nf">({ oid }) -&gt;</span>
         <span class="nv">fin = </span><span class="nf">(doc) =&gt;</span>
             <span class="nv">template = </span><span class="nx">require</span> <span class="s">&#39;./templates/page/detail&#39;</span>
             <span class="k">return</span> <span class="nx">@render</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="p">{},</span> <span class="s">&#39;ElasticMed&#39;</span><span class="p">)</span> <span class="k">unless</span> <span class="nx">doc</span>

             <span class="nv">title = </span><span class="nx">title</span><span class="p">.</span><span class="nx">value</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span> <span class="nv">title = </span><span class="nx">doc</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span>
             <span class="nx">@render</span> <span class="nx">template</span><span class="p">,</span> <span class="nx">doc</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">title</span><span class="si">}</span><span class="s"> - ElasticMed&quot;</span>

         <span class="c1"># Find the document.</span>
         <span class="nv">doc = </span><span class="kc">null</span>
         <span class="c1"># Is it in results?</span>
         <span class="k">if</span> <span class="p">(</span><span class="nv">docs = </span><span class="nx">results</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;docs&#39;</span><span class="p">)).</span><span class="nx">length</span>
             <span class="nx">docs</span><span class="p">.</span><span class="nx">each</span> <span class="nf">(obj) -&gt;</span>
                 <span class="c1"># Found already?</span>
                 <span class="k">return</span> <span class="k">if</span> <span class="nx">doc</span>
                 <span class="c1"># Match on oid.</span>
                 <span class="nv">doc = </span><span class="nx">obj</span> <span class="k">if</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;oid&#39;</span><span class="p">)</span> <span class="o">is</span> <span class="nx">oid</span>

         <span class="c1"># Found in results cache.</span>
         <span class="k">return</span> <span class="nx">fin</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="k">if</span> <span class="nx">doc</span>

         <span class="c1"># Get the document from the index.</span>
         <span class="nx">ejs</span><span class="p">.</span><span class="nx">get</span> <span class="nx">oid</span><span class="p">,</span> <span class="nf">(err, doc) -&gt;</span>
             <span class="c1"># Trouble?</span>
             <span class="nx">state</span><span class="p">.</span><span class="nx">error</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span> <span class="k">if</span> <span class="nx">err</span>
             <span class="c1"># Finish with either a document or nothing</span>
             <span class="c1">#  in which case (error will be shown).</span>
             <span class="nx">fin</span> <span class="nx">doc</span>

     <span class="c1"># Render a page. Update the page title.</span>
     <span class="nv">render: </span><span class="nf">(template, ctx, title) -&gt;</span>
         <span class="nx">@element</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;.content&#39;</span><span class="p">)</span>
         <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">render</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">))</span>
         <span class="c1"># Update title.</span>
         <span class="nb">document</span><span class="p">.</span><span class="nv">title = </span><span class="nx">title</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt>init</dt>
<dd>We are loading some components that we are using in this app into the memory and then rendering our app layout. This layout will setup the structure for our whole app.</dd>
<dt>route</dt>
<dd>Is a function that will be called when we are on the index page of the app. It renders the index page template.</dd>
<dt>doc/:oid route</dt>
<dd>Matches when we are looking at a detail of a document/publication. So if someone manually types in the address <tt class="docutils literal"><span class="pre">#!doc/438</span></tt> or it changes as a result of user interaction, this function gets called. We are either retrieving the document from a results cache or we are explicitely calling for a document from <a class="reference external" href="http://www.elasticsearch.org/">ElasticSearch</a>. Consider that when we search for documents, we get their content too so we do not need to fetch them again when looking at their <em>detail</em>. In contrast, someone could type in a random document address and we need to be ready for that. In either case we are calling the <tt class="docutils literal"><span class="pre">fin</span></tt> function on <em>line 19</em> to render the results.</dd>
<dt>render</dt>
<dd>Serves as a helper we have created that injects a template into the DOM and updates the page title.</dd>
</dl>
</div>
<div class="section" id="pages-templates">
<h3>Pages templates<a class="headerlink" href="#pages-templates" title="Permalink to this headline">¶</a></h3>
<p>When discussing the router we were talking about different page templates. Let us define them now.</p>
<p>In <tt class="docutils literal"><span class="pre">src/templates/page/index.mustache</span></tt>:</p>
<div class="highlight-python"><pre>&lt;p&gt;ElasticSearch through a collection of cancer related publications from PubMed. Use &lt;kbd&gt;Tab&lt;/kbd&gt; to autocomplete or &lt;kbd&gt;Enter&lt;/kbd&gt; to search.&lt;/p&gt;
&lt;div class="page index"&gt;
    &lt;app-search&gt;&lt;/app-search&gt;
    &lt;app-state&gt;&lt;/app-state&gt;
    &lt;app-results&gt;&lt;/app-results&gt;
&lt;/div&gt;</pre>
</div>
<p>This is the index template with three custom tags corresponding to different components:</p>
<dl class="docutils">
<dt>app-search</dt>
<dd>the search form</dd>
<dt>app-state</dt>
<dd>notification messages/titles</dd>
<dt>app-results</dt>
<dd>the results when our search is successful</dd>
</dl>
<p>Now for the template that gets rendered on a detail page, in <tt class="docutils literal"><span class="pre">src/templates/page/detail.mustache</span></tt>:</p>
<div class="highlight-python"><pre>&lt;div class="page detail"&gt;
    &lt;app-state&gt;&lt;/app-state&gt;
    {{ #oid }}
    &lt;div class="document detail"&gt;
        &lt;app-document link-to-detail="false" show-keywords="true"&gt;&lt;/app-document&gt;
    &lt;/div&gt;
    &lt;app-more&gt;&lt;/app-more&gt;
    {{ /oid }}
&lt;div&gt;</pre>
</div>
<p>We see that <tt class="docutils literal"><span class="pre">app-state</span></tt> is present, it will tell us when a doc is not found. If it is (we have a document <tt class="docutils literal"><span class="pre">oid</span></tt>) we show the rest of the page.</p>
<dl class="docutils">
<dt>app-document</dt>
<dd>Is the view of one document. We are passing extra parameters (options) into the context saying we don&#8217;t want to link to the detail page (we are on detail page) but we want to show keywords (which will not be shown on the index results set).</dd>
<dt>app-more</dt>
<dd>is a results set similar to <tt class="docutils literal"><span class="pre">app-results</span></tt> which corresponds to a component that will automatically search for and display documents that are similar like <em>this one</em>.</dd>
</dl>
</div>
<div class="section" id="application-search-template">
<h3>Application search template<a class="headerlink" href="#application-search-template" title="Permalink to this headline">¶</a></h3>
<p>This template will be rendered for the <tt class="docutils literal"><span class="pre">app-search</span></tt> component defined on the index page. In <tt class="docutils literal"><span class="pre">src/templates/search.mustache</span></tt>:</p>
<div class="highlight-mustache"><pre> &lt;div class="row collapse"&gt;
     &lt;div class="large-10 columns search"&gt;
         &lt;div class="faux"&gt;&lt;/div&gt;
         &lt;input class="text" type="text" maxlength="100" placeholder="Query..." value="{{ query.current }}" autofocus&gt;
         {{ #if suggestions.list.length }}
         &lt;ul class="f-dropdown suggestions" style="left:{{ suggestions.px }}px"&gt;
         {{ #suggestions.list }}
             &lt;li {{ #active }}class="active"{{ /active }}&gt;
                 &lt;a&gt;{{ text }}&lt;/a&gt;
             &lt;/li&gt;
         {{ /suggestions.list }}
         &lt;/ul&gt;
         {{ /if }}
     &lt;/div&gt;
     &lt;div class="large-2 columns"&gt;
         &lt;a class="button secondary postfix"&gt;
             &lt;span class="fa fa-search"&gt;&lt;/span&gt; Search
         &lt;/a&gt;
     &lt;/div&gt;
 &lt;/div&gt;
 {{ #if query.history.length }}
 &lt;div class="row collapse"&gt;
     &lt;h4&gt;History&lt;/h4&gt;
     &lt;ul class="breadcrumbs"&gt;
     {{ #query.history }}
         &lt;li&gt;&lt;a&gt;{{ . }}&lt;/a&gt;&lt;/li&gt;
     {{ /query.history }}
 &lt;/div&gt;
 {{ /if }}</pre>
</div>
<p>We are splitting the DOM into two parts. These parts have a <tt class="docutils literal"><span class="pre">row</span></tt> class on them representing the grid of the <a class="reference external" href="http://foundation.zurb.com/">Foundation</a> framework.</p>
<dl class="docutils">
<dt>div.search</dt>
<dd>The first part is split into two <tt class="docutils literal"><span class="pre">columns</span></tt>, one for the input field and the other for a button triggering search.</dd>
<dt>div.faux</dt>
<dd>We will want to get caret position from the input field. To do that we are going to get all of the text from the input field up to the caret position and then copy it over to a div that has the same CSS styling as us, but is invisible. Then we are going to get the width of this element. <tt class="docutils literal"><span class="pre">.faux</span></tt> is this element.</dd>
<dt>input.text</dt>
<dd>The place where input goes. We can see <a class="reference external" href="http://mustache.github.io/">Mustache</a> syntax here that outputs the value of the current query.</dd>
<dt>ul.suggestions</dt>
<dd>Show up when a list of suggestions has some items. Represents suggestions for the current word, hence the need to get the caret position. If some suggestions are &#8220;active&#8221; (we hover on them etc.) then we toggle their CSS class.</dd>
<dt>ul.breadcrumbs</dt>
<dd>A query history. Only shows up when it has items in it.</dd>
</dl>
</div>
<div class="section" id="application-search-component">
<h3>Application search component<a class="headerlink" href="#application-search-component" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../apps-comparison.html" title="Apps/* Comparison"
             >next</a> |</li>
        <li class="right" >
          <a href="publication-search.html" title="publication-search"
             >previous</a> |</li>
        <li><a href="../../index.html">InterMine  documentation</a> &raquo;</li>
          <li><a href="../index.html" >Embedding InterMine components</a> &raquo;</li>
          <li><a href="index.html" >Apps/C Grunt Build</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
                &copy; Copyright 2012, University of Cambridge.
            Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>